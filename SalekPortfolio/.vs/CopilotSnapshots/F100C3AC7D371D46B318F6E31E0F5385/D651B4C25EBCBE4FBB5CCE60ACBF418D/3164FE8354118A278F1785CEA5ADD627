document.addEventListener('DOMContentLoaded', function() {
    // Initialize core components only
    initNavigation();
    initSmoothScrolling();
    initMobileMenu();
    initResponsiveLayout();
});

// Navigation functionality (simplified - no scroll animations)
function initNavigation() {
    const navLinks = document.querySelectorAll('.nav-menu a');
    const sections = document.querySelectorAll('section');
    
    // Add active class to current section (without scroll effects)
    function updateActiveNav() {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (scrollY >= (sectionTop - 200)) {
                current = section.getAttribute('id');
            }
        });
        
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${current}`) {
                link.classList.add('active');
            }
        });
    }
    
    // Listen for scroll events (no animations)
    window.addEventListener('scroll', updateActiveNav);
    
    // Initial call
    updateActiveNav();
}

// Basic smooth scrolling for navigation links (no fancy effects)
function initSmoothScrolling() {
    const navLinks = document.querySelectorAll('a[href^="#"]');
    
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            const targetId = this.getAttribute('href');
            const targetSection = document.querySelector(targetId);
            
            if (targetSection) {
                // Close mobile menu if open
                closeMobileMenu();
                
                // Simple scroll to section
                targetSection.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });
}

// Scroll to section function for buttons (basic functionality)
function scrollToSection(sectionId) {
    const section = document.getElementById(sectionId);
    if (section) {
        // Close mobile menu if open
        closeMobileMenu();
        
        section.scrollIntoView({
            behavior: 'smooth'
        });
    }
}

// Mobile menu functionality (improved for better visibility)
function initMobileMenu() {
    // Create mobile menu toggle button with hamburger
    const menuToggle = document.createElement('button');
    menuToggle.className = 'mobile-menu-toggle';
    menuToggle.innerHTML = `
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    `;
    
    // Create overlay for mobile menu
    const overlay = document.createElement('div');
    overlay.className = 'mobile-overlay';
    
    document.body.appendChild(menuToggle);
    document.body.appendChild(overlay);
    
    const sideNav = document.querySelector('.side-nav');
    const hamburger = menuToggle.querySelector('.hamburger');
    
    // Toggle mobile menu
    menuToggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleMobileMenu();
    });
    
    // Close menu when clicking overlay
    overlay.addEventListener('click', function() {
        closeMobileMenu();
    });
    
    // Close menu when clicking on nav links (mobile)
    const navLinks = document.querySelectorAll('.nav-menu a');
    navLinks.forEach(link => {
        link.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    closeMobileMenu();
                }, 300); // Small delay for smooth transition
            }
        });
    });
    
    // Function to toggle mobile menu
    function toggleMobileMenu() {
        const isActive = sideNav.classList.contains('active');
        
        if (isActive) {
            closeMobileMenu();
        } else {
            openMobileMenu();
        }
    }
    
    // Function to open mobile menu
    function openMobileMenu() {
        sideNav.classList.add('active');
        overlay.classList.add('active');
        hamburger.classList.add('active');
        menuToggle.classList.add('active');
        document.body.classList.add('menu-open'); // Add class to prevent body scroll
        document.body.style.overflow = 'hidden'; // Prevent background scrolling
        
        // Ensure menu is properly positioned
        sideNav.style.transform = 'translateX(0)';
        sideNav.style.visibility = 'visible';
    }
    
    // Function to close mobile menu
    window.closeMobileMenu = function() {
        sideNav.classList.remove('active');
        overlay.classList.remove('active');
        hamburger.classList.remove('active');
        menuToggle.classList.remove('active');
        document.body.classList.remove('menu-open'); // Remove class
        document.body.style.overflow = 'auto'; // Restore scrolling
        
        // Ensure menu is properly hidden
        sideNav.style.transform = 'translateX(-100%)';
    }
    
    // Close menu on escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && sideNav.classList.contains('active')) {
            closeMobileMenu();
        }
    });
    
    // Handle window resize
    window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
            closeMobileMenu();
            // Reset side nav for desktop
            sideNav.style.transform = '';
            sideNav.style.visibility = '';
        }
    });
    
    // Initialize proper state
    if (window.innerWidth <= 768) {
        sideNav.style.transform = 'translateX(-100%)';
    }
}

// Responsive layout adjustments (improved)
function initResponsiveLayout() {
    function adjustLayout() {
        const screenWidth = window.innerWidth;
        const mainContent = document.querySelector('.main-content');
        const sideNav = document.querySelector('.side-nav');
        
        // Adjust main content margin based on screen size
        if (screenWidth <= 768) {
            mainContent.style.marginLeft = '0';
            // Ensure mobile menu is properly positioned
            if (sideNav && !sideNav.classList.contains('active')) {
                sideNav.style.transform = 'translateX(-100%)';
            }
        } else {
            mainContent.style.marginLeft = 'var(--nav-width)';
            // Reset side nav transform for desktop
            if (sideNav) {
                sideNav.style.transform = '';
                sideNav.classList.remove('active');
            }
            // Close mobile menu if it's open
            closeMobileMenu();
        }
    }
    
    // Initial adjustment
    adjustLayout();
    
    // Adjust on resize with debouncing
    let resizeTimeout;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(adjustLayout, 100);
    });
}

// Simple scroll to top functionality (basic, no animations)
function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

// Basic scroll to top button (no fancy effects)
function createScrollToTopButton() {
    const button = document.createElement('button');
    button.innerHTML = '<i class="fas fa-arrow-up"></i>';
    button.className = 'scroll-to-top';
    button.style.cssText = `
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 50px;
        height: 50px;
        background: linear-gradient(45deg, var(--primary-cyan), var(--neon-blue));
        color: var(--primary-bg);
        border: none;
        border-radius: 50%;
        font-size: 1.2rem;
        cursor: pointer;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);
    `;
    
    button.addEventListener('click', scrollToTop);
    
    // Simple show/hide based on scroll position (no complex animations)
    window.addEventListener('scroll', function() {
        if (window.scrollY > 500) {
            button.style.opacity = '1';
            button.style.visibility = 'visible';
        } else {
            button.style.opacity = '0';
            button.style.visibility = 'hidden';
        }
    });
    
    // Simple hover effect
    button.addEventListener('mouseenter', function() {
        this.style.transform = 'scale(1.05)';
    });
    
    button.addEventListener('mouseleave', function() {
        this.style.transform = 'scale(1)';
    });
    
    // Adjust position for mobile
    function adjustScrollButtonPosition() {
        if (window.innerWidth <= 768) {
            button.style.bottom = '1rem';
            button.style.right = '1rem';
            button.style.width = '45px';
            button.style.height = '45px';
        } else {
            button.style.bottom = '2rem';
            button.style.right = '2rem';
            button.style.width = '50px';
            button.style.height = '50px';
        }
    }
    
    window.addEventListener('resize', adjustScrollButtonPosition);
    adjustScrollButtonPosition();
    
    document.body.appendChild(button);
}

// Initialize scroll to top button
createScrollToTopButton();

// Basic loading function (no animations)
function initBasicLoading() {
    window.addEventListener('load', function() {
        document.body.style.overflow = 'auto';
        
        // Simple element reveal on page load (no fancy animations)
        const heroElements = document.querySelectorAll('.hero-text, .hero-image');
        heroElements.forEach((element) => {
            if (element) {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
            }
        });
    });
}

// Initialize basic loading
initBasicLoading();

// Global error handling
window.addEventListener('error', function(e) {
    console.error('JavaScript error:', e.error);
});

// Responsive text sizing for better mobile experience (no scroll effects)
function initResponsiveText() {
    const sectionTitles = document.querySelectorAll('.section-title');
    
    function adjustTextSizes() {
        const screenWidth = window.innerWidth;
        
        sectionTitles.forEach(title => {
            if (screenWidth <= 480) {
                title.style.fontSize = '1.8rem';
            } else if (screenWidth <= 768) {
                title.style.fontSize = '2.2rem';
            } else if (screenWidth <= 1024) {
                title.style.fontSize = '2.5rem';
            } else {
                title.style.fontSize = '3rem';
            }
        });
    }
    
    window.addEventListener('resize', adjustTextSizes);
    adjustTextSizes();
}

// Initialize responsive text
initResponsiveText();

// Touch handling for mobile devices (enhanced for menu)
function initTouchHandling() {
    let touchStartX = 0;
    let touchStartY = 0;
    
    document.addEventListener('touchstart', function(e) {
        touchStartX = e.touches[0].clientX;
        touchStartY = e.touches[0].clientY;
    }, { passive: true });
    
    document.addEventListener('touchmove', function(e) {
        const touchEndX = e.touches[0].clientX;
        const touchEndY = e.touches[0].clientY;
        const diffX = touchStartX - touchEndX;
        const diffY = touchStartY - touchEndY;
        
        // Close mobile menu on swipe left (only if horizontal swipe is dominant)
        if (Math.abs(diffX) > Math.abs(diffY) && diffX > 50) {
            const sideNav = document.querySelector('.side-nav');
            if (sideNav && sideNav.classList.contains('active')) {
                closeMobileMenu();
            }
        }
    }, { passive: true });
}

// Initialize touch handling
initTouchHandling();

// Additional mobile menu fixes
function initMobileMenuFixes() {
    const sideNav = document.querySelector('.side-nav');
    
    if (!sideNav) return;
    
    // Ensure menu height is properly set
    function setMenuHeight() {
        if (window.innerWidth <= 768) {
            sideNav.style.height = '100vh';
            sideNav.style.maxHeight = '100vh';
        }
    }
    
    // Initial setup
    setMenuHeight();
    
    // Update on resize
    window.addEventListener('resize', setMenuHeight);
    
    // Prevent scrolling issues
    window.addEventListener('orientationchange', function() {
        setTimeout(setMenuHeight, 100);
    });
}

// Initialize mobile menu fixes
initMobileMenuFixes();